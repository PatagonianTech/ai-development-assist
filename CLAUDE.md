# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview

This repository implements an AI-assisted development workflow system that integrates with Jira/Confluence via Atlassian MCP server. It uses a changelog-based ticket management system to track implementation tasks from design through completion.

## Core Workflow Architecture

The system follows a structured workflow for implementing tickets:

1. **Design Phase** (`/design`) - Creates implementation plans from Jira/Confluence tickets
2. **Implementation Phase** (`/implement`) - Executes the design plan
3. **Resume Phase** (`/resume`) - Continues work on existing tickets
4. **Changelog Update** (`/changelog`) - Updates changelog after manual changes

### Workflow Rules

All slash commands enforce a clean context requirement using the `ai_context_clean` variable. If you know this value, stop execution with "You should start from a clean context!" This prevents state pollution between operations.

## Changelog System

Located in `.changelog/`, this directory contains ticket files with the naming pattern:
```
.changelog/<ticket_identifier>-<ticket_title>.md
```

Each changelog file follows this structure:
```markdown
# $ticket_identifier - $ticket_title

## Description
[Task description]

## Requirements
- [ ] Requirement 1
- [ ] Requirement 2

## Implementation Details
[Technical considerations]

## Acceptance Criteria
- [ ] Criteria 1
- [ ] Criteria 2

## Notes
[Additional notes]

---

## Changelog (Auto-generated by Claude)
[Populated during implementation with compressed change history]
```

The changelog section tracks:
- What was implemented
- Files modified/created
- Key technical decisions
- Issues encountered and resolutions

## Branch Management

The project uses a release-based branching strategy:

- Base branches follow the `release/*` pattern (e.g., `release/12.34.5`)
- Ticket branches are prefixed with the ticket identifier: `<ticket_identifier>-<ticket_title>`
- `/implement` command automatically:
  - Identifies the latest `release/*` branch
  - Checks out existing ticket branch or creates new one
  - Handles multiple branch scenarios by prompting user selection

## MCP Server Integration

The repository is configured with four MCP servers in `.mcp.json`:

- **context7** - Library documentation lookup
- **browsermcp** - Web browsing capabilities
- **atlassian** - Jira/Confluence integration (primary data source)
- **playwright** - Browser automation

### Atlassian Integration

The `/design` command reads ticket requirements from Jira tickets. Confluence pages are used only for additional context, not as the primary source of requirements. This distinction is critical to avoid scope creep.

## Implementation Guidelines

When executing tickets via `/implement`:

1. **Reuse existing code** - Search for existing interfaces, components, classes, services, and types before creating new ones
2. **Document from source** - When creating models/types, describe properties based on documentation in the Jira ticket or Confluence page
3. **Keep it simple** - Follow the design plan without adding extra features or assumptions
4. **Update changelog** - After completing work, update the changelog section with compressed implementation details
5. **Never auto-commit** - All slash commands explicitly prohibit committing changes

## Git Workflow

The repository uses custom git slash commands:

- `/git:commit` - Commit current changes
- `/git:cpush` - Commit and push changes
- `/git:codereview` - Review uncommitted changes or latest commit

### Code Review Criteria

Reviews evaluate:
- Correctness (logic, edge cases)
- Readability (clarity, style consistency)
- Maintainability (abstractions, naming, structure)
- Performance (efficiency, unnecessary operations)
- Security/Reliability (vulnerabilities, error handling)
- Best Practices (language/framework conventions)

Reviews conclude with:
- ✅ Good (ready to commit)
- ⚠️ Needs minor improvement
- ❌ Problematic or risky changes

## Tool Restrictions by Command

Each slash command has specific tool allowances defined in its frontmatter:

### `/design` Command
- Can only READ files and use Atlassian MCP
- Can WRITE/UPDATE only within `.changelog/` directory
- Cannot make project implementation changes

### `/implement` and `/resume` Commands
- Full access to project source directories (`src-ts/`, `src/`, `migrations/`, `public/`, etc.)
- Can use git operations (add, commit, status, checkout)
- Can run yarn commands for building, testing, linting
- Can use Atlassian, context7, browsermcp, and playwright MCPs
- Can create/modify specific config files (package.json, tsconfig.json, docker-compose.yml, etc.)

### `/changelog` Command
- Can only READ files and use Atlassian MCP
- Can WRITE/UPDATE only within `.changelog/` directory
- Can use git status, log, diff commands (read-only)
- Compares ticket branch against specified release branch

## Error Handling

Commands have specific error scenarios:

- Missing ticket identifier → "Ticket $ticket_identifier not found in `.changelog/` directory"
- Missing release branch → "No branch with `release/` prefix found"
- Branch creation failure → "Failed to create branch $ticket_identifier-$ticket_title"
- Invalid changelog branch → "Branch <branch_name> not found in repository"
